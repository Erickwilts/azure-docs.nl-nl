---
title: Azure Instance Metadata Service | Microsoft Docs
description: RESTful-interface voor informatie over de compute-, netwerk- en geplande onderhoudsgebeurtenissen Linux-VM.
services: virtual-machines-linux
documentationcenter: ''
author: KumariSupriya
manager: harijayms
editor: ''
tags: azure-resource-manager
ms.service: virtual-machines-linux
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 04/25/2019
ms.author: sukumari
ms.reviewer: azmetadata
ms.openlocfilehash: 88de601caf984d2511229cd68190554086c3da38
ms.sourcegitcommit: 36c50860e75d86f0d0e2be9e3213ffa9a06f4150
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 05/16/2019
ms.locfileid: "65779561"
---
# <a name="azure-instance-metadata-service"></a>Azure Instance Metadata service

De Azure Instance Metadata Service bevat informatie over het uitvoeren van de exemplaren van de virtuele machine die kunnen worden gebruikt om te beheren en configureren uw virtuele machines.
Dit omvat gegevens zoals SKU, netwerkconfiguratie en geplande onderhoudsgebeurtenissen. Zie voor meer informatie over welk type informatie beschikbaar is, [metagegevens API's](#metadata-apis).

Van Azure Instance Metadata Service is een REST-eindpunt dat toegankelijk is voor alle IaaS-VM's die zijn gemaakt via de [Azure Resource Manager](https://docs.microsoft.com/rest/api/resources/).
Het eindpunt is beschikbaar op een bekende niet-routeerbare IP-adres (`169.254.169.254`) die kunnen worden gebruikt alleen de virtuele machine.

> [!IMPORTANT]
> Deze service is **algemeen beschikbaar** in alle Azure-regio's.  Deze ontvangt regelmatig updates om nieuwe informatie over VM-exemplaren weer te geven. Deze pagina geeft de actuele [metagegevens API's](#metadata-apis) beschikbaar.

## <a name="service-availability"></a>Beschikbaarheid van services

De service is beschikbaar in de algemeen beschikbare Azure-regio's. Niet alle API-versie is mogelijk beschikbaar in alle Azure-regio's.

Regio's                                        | Beschikbaarheid?                                 | Ondersteunde versies
-----------------------------------------------|-----------------------------------------------|-----------------
[Alle globale Azure regio's algemeen beschikbaar](https://azure.microsoft.com/regions/)     | Algemeen verkrijgbaar | 2017-04-02, 2017-08-01, 2017-12-01, 2018-02-01, 2018-04-02, 2018-10-01
[Azure Government](https://azure.microsoft.com/overview/clouds/government/)              | Algemeen verkrijgbaar | 2017-04-02, 2017-08-01, 2017-12-01, 2018-02-01, 2018-04-02, 2018-10-01
[Azure China](https://www.azure.cn/)                                                     | Algemeen verkrijgbaar | 2017-04-02, 2017-08-01, 2017-12-01, 2018-02-01, 2018-04-02, 2018-10-01
[Azure Duitsland](https://azure.microsoft.com/overview/clouds/germany/)                    | Algemeen verkrijgbaar | 2017-04-02, 2017-08-01, 2017-12-01, 2018-02-01, 2018-04-02, 2018-10-01
[Openbare West-Centraal VS](https://azure.microsoft.com/regions/)                           | Algemeen verkrijgbaar | 2017-04-02, 2017-08-01, 2017-12-01, 2018-02-01, 2018-04-02, 2018-10-01, 2019-02-01

Deze tabel wordt bijgewerkt wanneer er service-updates beschikbaar zijn en of nieuwe ondersteunde versies zijn beschikbaar.

> [!NOTE]
> 2019-02-01 wordt momenteel ophalen geïmplementeerd en is beschikbaar in andere regio's over enkele ogenblikken. 

Als u wilt de Instance Metadata Service uitproberen, maakt u een VM op basis van [Azure Resource Manager](https://docs.microsoft.com/rest/api/resources/) of de [Azure-portal](https://portal.azure.com) in de bovenstaande regio's en volg de onderstaande voorbeelden.

## <a name="usage"></a>Gebruik

### <a name="versioning"></a>Versiebeheer

De Instance Metadata Service is samengesteld. Versies zijn verplicht en de huidige versie op algemene Azure `2018-10-01`. Huidige ondersteunde versies zijn (2017-04-02, 2017-08-01, 2017-12-01, 2018-02-01, 2018-04-02, 10-01-2018).

Als nieuwe versies worden toegevoegd, oudere versies nog steeds toegankelijk voor compatibiliteit als uw scripts afhankelijk van de opmaak van bepaalde gegevens zijn.

Als er geen versie wordt opgegeven, wordt een fout geretourneerd met een lijst met de nieuwste ondersteunde versies.

> [!NOTE] 
> Het antwoord is een JSON-tekenreeks. Het volgende voorbeeldantwoord is pretty afgedrukt voor de leesbaarheid.

**Aanvraag**

```bash
curl -H Metadata:true "http://169.254.169.254/metadata/instance"
```

**Antwoord**

```json
{
    "error": "Bad request. api-version was not specified in the request. For more information refer to aka.ms/azureimds",
    "newest-versions": [
        "2018-10-01",
        "2018-04-02",
        "2018-02-01"
    ]
}
```

### <a name="using-headers"></a>Met behulp van headers

Wanneer u een query de Instance Metadata Service, moet u de header `Metadata: true` om te controleren of de aanvraag is niet per ongeluk wordt omgeleid.

### <a name="retrieving-metadata"></a>Bij het ophalen van metagegevens

Metagegevens van het exemplaar is beschikbaar voor het uitvoeren van virtuele machines die zijn gemaakt of worden beheerd met behulp van [Azure Resource Manager](https://docs.microsoft.com/rest/api/resources/). Toegang tot alle gegevenscategorieën voor een VM-exemplaar met behulp van de volgende aanvraag:

```bash
curl -H Metadata:true "http://169.254.169.254/metadata/instance?api-version=2017-08-01"
```

> [!NOTE]
> Alle exemplaar metagegevensquery's zijn hoofdlettergevoelig.

### <a name="data-output"></a>De gegevensuitvoer

Standaard de Instance Metadata Service gegevens geretourneerd in JSON-indeling (`Content-Type: application/json`). Verschillende API's retourneren echter gegevens in verschillende indelingen als aangevraagd.
De volgende tabel bevat een verwijzing van de opmaak van andere gegevens die API 's kunnen ondersteunen.

API | Standaardindeling voor gegevens | Andere indelingen
--------|---------------------|--------------
/ Instance | JSON | tekst
/scheduledevents | JSON | geen
/ blijkt | JSON | geen

Geef de vereiste indeling als een queryreeks-parameter in de aanvraag voor toegang tot een niet-standaard antwoordindeling. Bijvoorbeeld:

```bash
curl -H Metadata:true "http://169.254.169.254/metadata/instance?api-version=2017-08-01&format=text"
```

> [!NOTE]
> Voor bladknooppunten de `format=json` werkt niet. Voor deze query's `format=text` moet expliciet worden opgegeven als de standaardindeling json is.

### <a name="security"></a>Beveiliging

Het Instance Metadata Service-eindpunt is alleen toegankelijk vanuit het actieve exemplaar van de virtuele machine op een niet-routeerbare IP-adres. Bovendien een aanvraag met een `X-Forwarded-For` header is geweigerd door de service.
Aanvragen moeten ook bevatten een `Metadata: true` header om ervoor te zorgen dat de werkelijke aanvraag rechtstreeks bestemd en niet een deel van onbedoelde omleiding is.

### <a name="error"></a>Fout

Als er een gegevenselement niet gevonden of een onjuist gevormde aanvraag, retourneert de Instance Metadata Service standaard HTTP-fouten. Bijvoorbeeld:

HTTP-statuscode | Reason
----------------|-------
200 OK |
400-Ongeldige aanvraag | Ontbrekende `Metadata: true` kop- of de indeling ontbreekt bij het opvragen van een leaf-knooppunt
404 Niet gevonden | Het gevraagde element bestaat niet
405 methode is niet toegestaan | Alleen `GET` en `POST` aanvragen worden ondersteund
429 te veel aanvragen | De API ondersteunt momenteel een maximum van 5 query's per seconde
500 servicefout     | Voer na enige tijd opnieuw uit

### <a name="examples"></a>Voorbeelden

> [!NOTE]
> Alle API-antwoorden zijn JSON-tekenreeksen. Alle volgende voorbeeldantwoorden zijn behoorlijk afgedrukt voor de leesbaarheid.

#### <a name="retrieving-network-information"></a>Bij het ophalen van informatie over het netwerk

**Aanvraag**

```bash
curl -H Metadata:true "http://169.254.169.254/metadata/instance/network?api-version=2017-08-01"
```

**Antwoord**

> [!NOTE]
> Het antwoord is een JSON-tekenreeks. Het volgende voorbeeldantwoord is pretty afgedrukt voor de leesbaarheid.

```json
{
  "interface": [
    {
      "ipv4": {
        "ipAddress": [
          {
            "privateIpAddress": "10.1.0.4",
            "publicIpAddress": "X.X.X.X"
          }
        ],
        "subnet": [
          {
            "address": "10.1.0.0",
            "prefix": "24"
          }
        ]
      },
      "ipv6": {
        "ipAddress": []
      },
      "macAddress": "000D3AF806EC"
    }
  ]
}

```

#### <a name="retrieving-public-ip-address"></a>Bij het ophalen van openbare IP-adres

```bash
curl -H Metadata:true "http://169.254.169.254/metadata/instance/network/interface/0/ipv4/ipAddress/0/publicIpAddress?api-version=2017-08-01&format=text"
```

#### <a name="retrieving-all-metadata-for-an-instance"></a>Het ophalen van alle metagegevens voor een exemplaar

**Aanvraag**

```bash
curl -H Metadata:true "http://169.254.169.254/metadata/instance?api-version=2018-10-01"
```

**Antwoord**

> [!NOTE]
> Het antwoord is een JSON-tekenreeks. Het volgende voorbeeldantwoord is pretty afgedrukt voor de leesbaarheid.

```json
{
  "compute": {
    "azEnvironment": "AZUREPUBLICCLOUD",
    "location": "centralus",
    "name": "negasonic",
    "offer": "lampstack",
    "osType": "Linux",
    "placementGroupId": "",
    "plan": {
        "name": "5-6",
        "product": "lampstack",
        "publisher": "bitnami"
    },
    "platformFaultDomain": "0",
    "platformUpdateDomain": "0",
    "provider": "Microsoft.Compute",
    "publicKeys": [],
    "publisher": "bitnami",
    "resourceGroupName": "myrg",
    "sku": "5-6",
    "subscriptionId": "xxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxx",
    "tags": "Department:IT;Environment:Prod;Role:WorkerRole",
    "version": "7.1.1902271506",
    "vmId": "13f56399-bd52-4150-9748-7190aae1ff21",
    "vmScaleSetName": "",
    "vmSize": "Standard_A1_v2",
    "zone": "1"
  },
  "network": {
    "interface": [
      {
        "ipv4": {
          "ipAddress": [
            {
              "privateIpAddress": "10.1.2.5",
              "publicIpAddress": "X.X.X.X"
            }
          ],
          "subnet": [
            {
              "address": "10.1.2.0",
              "prefix": "24"
            }
          ]
        },
        "ipv6": {
          "ipAddress": []
        },
        "macAddress": "000D3A36DDED"
      }
    ]
  }
}
```

#### <a name="retrieving-metadata-in-windows-virtual-machine"></a>Bij het ophalen van metagegevens in Windows virtuele Machine

**Aanvraag**

Metagegevens van het exemplaar in Windows kan worden opgehaald via de PowerShell-hulpprogramma `curl`: 

```bash
curl -H @{'Metadata'='true'} http://169.254.169.254/metadata/instance?api-version=2018-10-01 | select -ExpandProperty Content
```

Of via de `Invoke-RestMethod` cmdlet:

```powershell

Invoke-RestMethod -Headers @{"Metadata"="true"} -URI http://169.254.169.254/metadata/instance?api-version=2018-10-01 -Method get 
```

**Antwoord**

> [!NOTE]
> Het antwoord is een JSON-tekenreeks. Het volgende voorbeeldantwoord is pretty afgedrukt voor de leesbaarheid.

```json
{
  "compute": {
    "azEnvironment": "AZUREPUBLICCLOUD",
    "location": "centralus",
    "name": "negasonic",
    "offer": "lampstack",
    "osType": "Linux",
    "placementGroupId": "",
    "plan": {
        "name": "5-6",
        "product": "lampstack",
        "publisher": "bitnami"
    },
    "platformFaultDomain": "0",
    "platformUpdateDomain": "0",
    "provider": "Microsoft.Compute",
    "publicKeys": [],
    "publisher": "bitnami",
    "resourceGroupName": "myrg",
    "sku": "5-6",
    "subscriptionId": "xxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxx",
    "tags": "Department:IT;Environment:Test;Role:WebRole",
    "version": "7.1.1902271506",
    "vmId": "13f56399-bd52-4150-9748-7190aae1ff21",
    "vmScaleSetName": "",
    "vmSize": "Standard_A1_v2",
    "zone": "1"
  },
  "network": {
    "interface": [
      {
        "ipv4": {
          "ipAddress": [
            {
              "privateIpAddress": "10.0.1.4",
              "publicIpAddress": "X.X.X.X"
            }
          ],
          "subnet": [
            {
              "address": "10.0.1.0",
              "prefix": "24"
            }
          ]
        },
        "ipv6": {
          "ipAddress": []
        },
        "macAddress": "002248020E1E"
      }
    ]
  }
}
```

## <a name="metadata-apis"></a>De metagegevens van API 's

#### <a name="the-following-apis-are-available-through-the-metadata-endpoint"></a>De volgende API's zijn beschikbaar via het eindpunt voor metagegevens:

Gegevens | Description | Versie geïntroduceerd
-----|-------------|-----------------------
Attestation | Zie [Attestation-gegevens](#attested-data) | 10-01-2018
identity | Beheerde identiteiten voor Azure-resources. Zie [een toegangstoken verkrijgen](../../active-directory/managed-identities-azure-resources/how-to-use-vm-token.md) | 2018-02-01
exemplaar | Zie [exemplaar van API](#instance-api) | 2017-04-02
scheduledevents | Zie [geplande gebeurtenissen](scheduled-events.md) | 2017-08-01

#### <a name="instance-api"></a>Exemplaar van API
##### <a name="the-following-compute-categories-are-available-through-the-instance-api"></a>De volgende Compute-categorieën zijn beschikbaar via de API-exemplaar:

> [!NOTE]
> Via het eindpunt van de metagegevens van zijn de volgende categorieën toegankelijk via exemplaar/compute

Gegevens | Description | Versie geïntroduceerd
-----|-------------|-----------------------
azEnvironment | Azure-omgeving waarop de virtuele machine wordt uitgevoerd in | 10-01-2018
customData | Zie [aangepaste gegevens](#custom-data) | 2019-02-01
location | Azure-regio de virtuele machine wordt uitgevoerd in | 2017-04-02
naam | Naam van de virtuele machine | 2017-04-02
aanbieding | Bieden van informatie voor de VM-installatiekopie en wordt alleen aanwezig zijn voor installatiekopieën geïmplementeerd vanuit de galerie met installatiekopieën van Azure | 2017-04-02
besturingssysteemtype | Linux of Windows | 2017-04-02
placementGroupId | [Plaatsingsgroep](../../virtual-machine-scale-sets/virtual-machine-scale-sets-placement-groups.md) instellen van uw virtuele-machineschaalset | 2017-08-01
plan | [Plan](https://docs.microsoft.com/rest/api/compute/virtualmachines/createorupdate#plan) met de naam, product en uitgever voor een virtuele machine als het een Azure Marketplace-installatiekopie | 2018-04-02
platformUpdateDomain |  [Updatedomein](manage-availability.md) in de virtuele machine wordt uitgevoerd | 2017-04-02
platformFaultDomain | [Foutdomein](manage-availability.md) in de virtuele machine wordt uitgevoerd | 2017-04-02
provider | Provider van de virtuele machine | 10-01-2018
publicKeys | [Verzameling van openbare sleutels](https://docs.microsoft.com/rest/api/compute/virtualmachines/createorupdate#sshpublickey) toegewezen aan de virtuele machine en de paden | 2018-04-02
Uitgever | Uitgever van de VM-installatiekopie | 2017-04-02
resourceGroupName | [Resourcegroep](../../azure-resource-manager/resource-group-overview.md) voor uw virtuele Machine | 2017-08-01
sku | Specifieke SKU voor de VM-installatiekopie | 2017-04-02
subscriptionId | Azure-abonnement voor de virtuele Machine | 2017-08-01
codes | [Tags](../../azure-resource-manager/resource-group-using-tags.md) voor uw virtuele Machine  | 2017-08-01
version | Versie van de VM-installatiekopie | 2017-04-02
vmId | [De unieke id](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/) voor de virtuele machine | 2017-04-02
vmScaleSetName | [Naam van de virtuele Machine ScaleSet](../../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) instellen van uw virtuele-machineschaalset | 2017-12-01
vmSize | [VM-grootte](sizes.md) | 2017-04-02
zone | [Binnen een Beschikbaarheidszone](../../availability-zones/az-overview.md) van uw virtuele machine | 2017-12-01

##### <a name="the-following-network-categories-are-available-through-the-instance-api"></a>De volgende Netwerkcategorieën zijn beschikbaar via de API-exemplaar:

> [!NOTE]
> Via het eindpunt van de metagegevens van zijn de volgende categorieën toegankelijk via het netwerk-instantie-interface

Gegevens | Description | Versie geïntroduceerd
-----|-------------|-----------------------
ipv4/privateIpAddress | Lokale IPv4-adres van de virtuele machine | 2017-04-02
ipv4/publicIpAddress | Openbare IPv4-adres van de virtuele machine | 2017-04-02
subnet/address | Subnetadres van de virtuele machine | 2017-04-02
subnet/prefix | Het subnetvoorvoegsel, voorbeeld 24 uur per dag | 2017-04-02
ipv6/ipAddress | Lokale IPv6-adres van de virtuele machine | 2017-04-02
MAC-adres | VM-mac-adres | 2017-04-02

## <a name="attested-data"></a>Blijkt gegevens

Metagegevens van het exemplaar reageert op http-eindpunt op 169.254.169.254. Onderdeel van het scenario dat wordt bediend door Instance Metadata Service is het bieden van garanties dat de gegevens heeft gereageerd afkomstig is van Azure. We een deel van deze informatie ondertekenen zodat marketplace-installatiekopieën ervoor dat deze de installatiekopie die wordt uitgevoerd op Azure kunnen worden.

### <a name="example-attested-data"></a>Voorbeeld van de Attestation-gegevens

> [!NOTE]
> Alle API-antwoorden zijn JSON-tekenreeksen. Het volgende voorbeeldantwoorden zijn pretty afgedrukt voor de leesbaarheid.

 **Aanvraag**

 ```bash
curl -H Metadata:true "http://169.254.169.254/metadata/attested/document?api-version=2018-10-01&nonce=1234567890"

```

API-versie is een verplicht veld zijn en de versie die wordt ondersteund voor blijkt gegevens 2018-01-10 is.
Nonce is een optionele 10 cijfers tekenreeks opgegeven. Nonce kan worden gebruikt voor het bijhouden van de aanvraag en indien niet opgegeven, in antwoord gecodeerde tekenreeks, de huidige UTC tijdstempel wordt geretourneerd.

 **Antwoord**

> [!NOTE]
> Het antwoord is een JSON-tekenreeks. Het volgende voorbeeldantwoord is pretty afgedrukt voor de leesbaarheid.

 ```json
{
 "encoding":"pkcs7","signature":"MIIEEgYJKoZIhvcNAQcCoIIEAzCCA/8CAQExDzANBgkqhkiG9w0BAQsFADCBugYJKoZIhvcNAQcBoIGsBIGpeyJub25jZSI6IjEyMzQ1NjY3NjYiLCJwbGFuIjp7Im5hbWUiOiIiLCJwcm9kdWN0IjoiIiwicHVibGlzaGVyIjoiIn0sInRpbWVTdGFtcCI6eyJjcmVhdGVkT24iOiIxMS8yMC8xOCAyMjowNzozOSAtMDAwMCIsImV4cGlyZXNPbiI6IjExLzIwLzE4IDIyOjA4OjI0IC0wMDAwIn0sInZtSWQiOiIifaCCAj8wggI7MIIBpKADAgECAhBnxW5Kh8dslEBA0E2mIBJ0MA0GCSqGSIb3DQEBBAUAMCsxKTAnBgNVBAMTIHRlc3RzdWJkb21haW4ubWV0YWRhdGEuYXp1cmUuY29tMB4XDTE4MTEyMDIxNTc1N1oXDTE4MTIyMDIxNTc1NlowKzEpMCcGA1UEAxMgdGVzdHN1YmRvbWFpbi5tZXRhZGF0YS5henVyZS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAML/tBo86ENWPzmXZ0kPkX5dY5QZ150mA8lommszE71x2sCLonzv4/UWk4H+jMMWRRwIea2CuQ5RhdWAHvKq6if4okKNt66fxm+YTVz9z0CTfCLmLT+nsdfOAsG1xZppEapC0Cd9vD6NCKyE8aYI1pliaeOnFjG0WvMY04uWz2MdAgMBAAGjYDBeMFwGA1UdAQRVMFOAENnYkHLa04Ut4Mpt7TkJFfyhLTArMSkwJwYDVQQDEyB0ZXN0c3ViZG9tYWluLm1ldGFkYXRhLmF6dXJlLmNvbYIQZ8VuSofHbJRAQNBNpiASdDANBgkqhkiG9w0BAQQFAAOBgQCLSM6aX5Bs1KHCJp4VQtxZPzXF71rVKCocHy3N9PTJQ9Fpnd+bYw2vSpQHg/AiG82WuDFpPReJvr7Pa938mZqW9HUOGjQKK2FYDTg6fXD8pkPdyghlX5boGWAMMrf7bFkup+lsT+n2tRw2wbNknO1tQ0wICtqy2VqzWwLi45RBwTGB6DCB5QIBATA/MCsxKTAnBgNVBAMTIHRlc3RzdWJkb21haW4ubWV0YWRhdGEuYXp1cmUuY29tAhBnxW5Kh8dslEBA0E2mIBJ0MA0GCSqGSIb3DQEBCwUAMA0GCSqGSIb3DQEBAQUABIGAld1BM/yYIqqv8SDE4kjQo3Ul/IKAVR8ETKcve5BAdGSNkTUooUGVniTXeuvDj5NkmazOaKZp9fEtByqqPOyw/nlXaZgOO44HDGiPUJ90xVYmfeK6p9RpJBu6kiKhnnYTelUk5u75phe5ZbMZfBhuPhXmYAdjc7Nmw97nx8NnprQ="
}
```

> De handtekening-blob is een [pkcs7](https://aka.ms/pkcs7) versie van het document is ondertekend. Het bevat het certificaat voor ondertekening, samen met de details van de virtuele machine, zoals vmId, nonce, timeStamp voor het maken en de vervaldatum van het document en de schema-informatie over de installatiekopie van het. De schema-informatie wordt alleen ingevuld voor installatiekopieën van Azure-markt plaats. Het certificaat kan worden opgehaald uit het antwoord en gebruikt om te valideren dat de reactie geldig is en afkomstig is van Azure.

#### <a name="retrieving-attested-metadata-in-windows-virtual-machine"></a>Bij het ophalen van blijkt metagegevens in Windows virtuele Machine

 **Aanvraag**

Metagegevens van het exemplaar in Windows kan worden opgehaald via de PowerShell-hulpprogramma `curl`:

 ```bash
curl -H @{'Metadata'='true'} "http://169.254.169.254/metadata/attested/document?api-version=2018-10-01&nonce=1234567890" | select -ExpandProperty Content
```

 Of via de `Invoke-RestMethod` cmdlet:

 ```powershell
Invoke-RestMethod -Headers @{"Metadata"="true"} -URI "http://169.254.169.254/metadata/attested/document?api-version=2018-10-01&nonce=1234567890" -Method get
```

API-versie is een verplicht veld zijn en de versie die wordt ondersteund voor blijkt gegevens 2018-01-10 is.
Nonce is een optionele 10 cijfers tekenreeks opgegeven. Nonce kan worden gebruikt voor het bijhouden van de aanvraag en indien niet opgegeven, in antwoord gecodeerde tekenreeks, de huidige UTC tijdstempel wordt geretourneerd.

 **Antwoord**

> [!NOTE]
> Het antwoord is een JSON-tekenreeks. Het volgende voorbeeldantwoord is pretty afgedrukt voor de leesbaarheid.

 ```json
{
 "encoding":"pkcs7","signature":"MIIEEgYJKoZIhvcNAQcCoIIEAzCCA/8CAQExDzANBgkqhkiG9w0BAQsFADCBugYJKoZIhvcNAQcBoIGsBIGpeyJub25jZSI6IjEyMzQ1NjY3NjYiLCJwbGFuIjp7Im5hbWUiOiIiLCJwcm9kdWN0IjoiIiwicHVibGlzaGVyIjoiIn0sInRpbWVTdGFtcCI6eyJjcmVhdGVkT24iOiIxMS8yMC8xOCAyMjowNzozOSAtMDAwMCIsImV4cGlyZXNPbiI6IjExLzIwLzE4IDIyOjA4OjI0IC0wMDAwIn0sInZtSWQiOiIifaCCAj8wggI7MIIBpKADAgECAhBnxW5Kh8dslEBA0E2mIBJ0MA0GCSqGSIb3DQEBBAUAMCsxKTAnBgNVBAMTIHRlc3RzdWJkb21haW4ubWV0YWRhdGEuYXp1cmUuY29tMB4XDTE4MTEyMDIxNTc1N1oXDTE4MTIyMDIxNTc1NlowKzEpMCcGA1UEAxMgdGVzdHN1YmRvbWFpbi5tZXRhZGF0YS5henVyZS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAML/tBo86ENWPzmXZ0kPkX5dY5QZ150mA8lommszE71x2sCLonzv4/UWk4H+jMMWRRwIea2CuQ5RhdWAHvKq6if4okKNt66fxm+YTVz9z0CTfCLmLT+nsdfOAsG1xZppEapC0Cd9vD6NCKyE8aYI1pliaeOnFjG0WvMY04uWz2MdAgMBAAGjYDBeMFwGA1UdAQRVMFOAENnYkHLa04Ut4Mpt7TkJFfyhLTArMSkwJwYDVQQDEyB0ZXN0c3ViZG9tYWluLm1ldGFkYXRhLmF6dXJlLmNvbYIQZ8VuSofHbJRAQNBNpiASdDANBgkqhkiG9w0BAQQFAAOBgQCLSM6aX5Bs1KHCJp4VQtxZPzXF71rVKCocHy3N9PTJQ9Fpnd+bYw2vSpQHg/AiG82WuDFpPReJvr7Pa938mZqW9HUOGjQKK2FYDTg6fXD8pkPdyghlX5boGWAMMrf7bFkup+lsT+n2tRw2wbNknO1tQ0wICtqy2VqzWwLi45RBwTGB6DCB5QIBATA/MCsxKTAnBgNVBAMTIHRlc3RzdWJkb21haW4ubWV0YWRhdGEuYXp1cmUuY29tAhBnxW5Kh8dslEBA0E2mIBJ0MA0GCSqGSIb3DQEBCwUAMA0GCSqGSIb3DQEBAQUABIGAld1BM/yYIqqv8SDE4kjQo3Ul/IKAVR8ETKcve5BAdGSNkTUooUGVniTXeuvDj5NkmazOaKZp9fEtByqqPOyw/nlXaZgOO44HDGiPUJ90xVYmfeK6p9RpJBu6kiKhnnYTelUk5u75phe5ZbMZfBhuPhXmYAdjc7Nmw97nx8NnprQ="
}
```

> De handtekening-blob is een [pkcs7](https://aka.ms/pkcs7) versie van het document is ondertekend. Het bevat het certificaat voor ondertekening, samen met de details van de virtuele machine, zoals vmId, nonce, timeStamp voor het maken en de vervaldatum van het document en de schema-informatie over de installatiekopie van het. De schema-informatie wordt alleen ingevuld voor installatiekopieën van Azure-markt plaats. Het certificaat kan worden opgehaald uit het antwoord en gebruikt om te valideren dat de reactie geldig is en afkomstig is van Azure.


## <a name="example-scenarios-for-usage"></a>Voorbeeldscenario's voor gebruik  

### <a name="tracking-vm-running-on-azure"></a>VM bijhouden waarop Azure wordt uitgevoerd

Als een serviceprovider, hebt u mogelijk nodig bij te houden van het aantal virtuele machines met uw software of agents die nodig hebt om bij te houden van uniekheid van de virtuele machine hebben. Als u een unieke ID voor een virtuele machine ophalen, gebruikt u de `vmId` veld Instance Metadata Service.

**Aanvraag**

```bash
curl -H Metadata:true "http://169.254.169.254/metadata/instance/compute/vmId?api-version=2017-08-01&format=text"
```

**Antwoord**

```text
5c08b38e-4d57-4c23-ac45-aca61037f084
```

### <a name="placement-of-containers-data-partitions-based-faultupdate-domain"></a>Plaatsen van containers, fout-/updatedomein op basis van gegevenspartities

Voor bepaalde scenario's, plaatsing van replica's van andere gegevens is van belang is aangewezen. Bijvoorbeeld, [HDFS replica plaatsing](https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/HdfsDesign.html#Replica_Placement:_The_First_Baby_Steps) of de positie van de container via een [orchestrator](https://kubernetes.io/docs/user-guide/node-selection/) kan u nodig hebt om te weten de `platformFaultDomain` en `platformUpdateDomain` op de virtuele machine wordt uitgevoerd.
U kunt ook [Beschikbaarheidszones](../../availability-zones/az-overview.md) voor de exemplaren van deze beslissingen te nemen.
U kunt deze gegevens rechtstreeks via de Instance Metadata Service op te vragen.

**Aanvraag**

```bash
curl -H Metadata:true "http://169.254.169.254/metadata/instance/compute/platformFaultDomain?api-version=2017-08-01&format=text"
```

**Antwoord**

```text
0
```

### <a name="getting-more-information-about-the-vm-during-support-case"></a>Meer informatie krijgen over de VM tijdens de ondersteuningsaanvraag

Als een serviceprovider krijgt u mogelijk een telefoongesprek ondersteuning waar u wilt meer informatie over de virtuele machine. Waarin wordt gevraagd de klant voor het delen van de metagegevens van de compute krijgt u algemene informatie voor de ondersteuning van professional op de hoogte van het type van de virtuele machine op Azure.

**Aanvraag**

```bash
curl -H Metadata:true "http://169.254.169.254/metadata/instance/compute?api-version=2017-08-01"
```

**Antwoord**

> [!NOTE]
> Het antwoord is een JSON-tekenreeks. Het volgende voorbeeldantwoord is pretty afgedrukt voor de leesbaarheid.

```json
{
  "compute": {
    "location": "CentralUS",
    "name": "IMDSCanary",
    "offer": "RHEL",
    "osType": "Linux",
    "platformFaultDomain": "0",
    "platformUpdateDomain": "0",
    "publisher": "RedHat",
    "sku": "7.2",
    "version": "7.2.20161026",
    "vmId": "5c08b38e-4d57-4c23-ac45-aca61037f084",
    "vmSize": "Standard_DS2"
  }
}
```

### <a name="getting-azure-environment-where-the-vm-is-running"></a>Azure-omgeving ophalen waarin de VM wordt uitgevoerd

Azure heeft verschillende onafhankelijke clouds, zoals [Azure Government](https://azure.microsoft.com/overview/clouds/government/). Soms moet u de Azure-omgeving om sommige runtime beslissingen te nemen. Het volgende voorbeeld laat zien hoe u dit gedrag kunt bereiken.

**Aanvraag**
```bash
curl -H Metadata:true "http://169.254.169.254/metadata/instance/compute/azEnvironment?api-version=2018-10-01&format=text"
```

**Antwoord**
```bash
AZUREPUBLICCLOUD
```

### <a name="getting-the-tags-for-the-vm"></a>De labels ophalen voor de virtuele machine

Tags mogelijk zijn toegepast op uw Azure-VM naar een logische manier te organiseren in een taxonomie. De labels die zijn toegewezen aan een virtuele machine kunnen worden opgehaald met behulp van de onderstaande aanvraag.

**Aanvraag**

```bash
curl -H Metadata:true "http://169.254.169.254/metadata/instance/compute/tags?api-version=2018-10-01&format=text"
```

**Antwoord**

```text
Department:IT;Environment:Test;Role:WebRole
```

> [!NOTE]
> De labels worden gescheiden door puntkomma's. Als een parser is geschreven om op te halen via een programma de labels, mag niet de labelnamen en -waarden puntkomma's in volgorde voor de parser correct te laten werken bevatten.

### <a name="validating-that-the-vm-is-running-in-azure"></a>Valideren dat Azure wordt uitgevoerd op de VM

Marketplace-leveranciers ervoor wilt zorgen dat de software is gelicentieerd voor het alleen worden uitgevoerd in Azure. Als iemand de VHD uit naar kopieert on-premises, klikt u vervolgens ze moeten de mogelijkheid hebben om te detecteren die. Aanroepen naar Instance Metadata Service krijgt Marketplace leveranciers ondertekende gegevens die alleen Azure-antwoord wordt gegarandeerd.

> [!NOTE]
> Vereist jq moet worden geïnstalleerd.

**Aanvraag**

 ```bash
  # Get the signature
   curl  --silent -H Metadata:True http://169.254.169.254/metadata/attested/document?api-version=2018-10-01 | jq -r '.["signature"]' > signature
  # Decode the signature
  base64 -d signature > decodedsignature
  #Get PKCS7 format
  openssl pkcs7 -in decodedsignature -inform DER -out sign.pk7
  # Get Public key out of pkc7
  openssl pkcs7 -in decodedsignature -inform DER  -print_certs -out signer.pem
  #Get the intermediate certificate
  wget -q -O intermediate.cer "$(openssl x509 -in signer.pem -text -noout | grep " CA Issuers -" | awk -FURI: '{print $2}')"
  openssl x509 -inform der -in intermediate.cer -out intermediate.pem
  #Verify the contents
  openssl smime -verify -in sign.pk7 -inform pem -noverify
 ```

 **Antwoord**

```json
Verification successful
{"nonce":"20181128-001617",
  "plan":
    {
     "name":"",
     "product":"",
     "publisher":""
    },
"timeStamp":
  {
    "createdOn":"11/28/18 00:16:17 -0000",
    "expiresOn":"11/28/18 06:16:17 -0000"
  },
"vmId":"d3e0e374-fda6-4649-bbc9-7f20dc379f34"
}
```

Gegevens | Description
-----|------------
nonce | Gebruiker opgegeven optionele tekenreeks met de aanvraag. Als er geen nonce is opgegeven in de aanvraag, wordt de huidige UTC-timestamp geretourneerd
plan | [Plan](https://docs.microsoft.com/rest/api/compute/virtualmachines/createorupdate#plan) voor een virtuele machine in het is een Azure Marketplace-installatiekopie, bevat de naam, product en uitgever
timestamp/createdOn | De tijdstempel waarmee het eerste ondertekende document is gemaakt
timestamp/expiresOn | De tijdstempel die het ondertekende document is verlopen
vmId |  [De unieke id](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/) voor de virtuele machine

#### <a name="verifying-the-signature"></a>Verifiëren van de handtekening

Wanneer u de bovenstaande handtekening, kunt u controleren of de handtekening van Microsoft is. U kunt ook controleren of het tussenliggende certificaat en de certificaatketen.

> [!NOTE]
> Het certificaat voor de openbare cloud en onafhankelijke Clouds zijn verschillend.

 Regio's | Certificaat
---------|-----------------
[Alle globale Azure regio's algemeen beschikbaar](https://azure.microsoft.com/regions/)     | metadata.azure.com
[Azure Government](https://azure.microsoft.com/overview/clouds/government/)              | metadata.azure.us
[Azure China](https://www.azure.cn/)                                                           | metadata.azure.cn
[Azure Duitsland](https://azure.microsoft.com/overview/clouds/germany/)                    | metadata.microsoftazure.de

```bash

# Verify the subject name for the main certificate
openssl x509 -noout -subject -in signer.pem
# Verify the issuer for the main certificate
openssl x509 -noout -issuer -in signer.pem
#Validate the subject name for intermediate certificate
openssl x509 -noout -subject -in intermediate.pem
# Verify the issuer for the intermediate certificate
openssl x509 -noout -issuer -in intermediate.pem
# Verify the certificate chain
openssl verify -verbose -CAfile /etc/ssl/certs/Baltimore_CyberTrust_Root.pem -untrusted intermediate.pem signer.pem
```

In gevallen waar de tussenliggende certificaat kan niet worden gedownload vanwege een netwerkbeperkingen tijdens het valideren van kan de tussenliggende certificaten worden vastgemaakt. Azure wordt echter de certificaten aan de hand van PKI-standaardprocedure meenemen. De vastgemaakte certificaten moet worden bijgewerkt als rollover gebeurt. Wanneer een wijziging in de tussenliggende certificaat bijwerken is gepland, de Azure-blog wordt bijgewerkt en Azure-klanten worden ontvangen. De tussenliggende certificaten vindt [hier](https://www.microsoft.com/pki/mscorp/cps/default.htm). De tussenliggende certificaten voor elk van de regio's kunnen afwijken.

### <a name="failover-clustering-in-windows-server"></a>Failover Clustering in WindowsServer

Voor bepaalde scenario's, bij het opvragen van Instance Metadata Service met Failover Clustering, dit is nodig om een route toevoegen aan de routeringstabel.

1. Open de opdrachtprompt met beheerdersbevoegdheden.

2. Voer de volgende opdracht uit en noteer het adres van de Interface voor het netwerkadres (`0.0.0.0`) in de routetabel voor IPv4.

```bat
route print
```

> [!NOTE] 
> De volgende voorbeelduitvoer van een Windows Server-VM met Failover-Cluster ingeschakeld bevat alleen de IPv4-Route-Table voor het gemak.

```bat
IPv4 Route Table
===========================================================================
Active Routes:
Network Destination        Netmask          Gateway       Interface  Metric
          0.0.0.0          0.0.0.0         10.0.1.1        10.0.1.10    266
         10.0.1.0  255.255.255.192         On-link         10.0.1.10    266
        10.0.1.10  255.255.255.255         On-link         10.0.1.10    266
        10.0.1.15  255.255.255.255         On-link         10.0.1.10    266
        10.0.1.63  255.255.255.255         On-link         10.0.1.10    266
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331
      169.254.0.0      255.255.0.0         On-link     169.254.1.156    271
    169.254.1.156  255.255.255.255         On-link     169.254.1.156    271
  169.254.255.255  255.255.255.255         On-link     169.254.1.156    271
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331
        224.0.0.0        240.0.0.0         On-link     169.254.1.156    271
        224.0.0.0        240.0.0.0         On-link         10.0.1.10    266
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331
  255.255.255.255  255.255.255.255         On-link     169.254.1.156    271
  255.255.255.255  255.255.255.255         On-link         10.0.1.10    266
```

1. Voer de volgende opdracht uit en gebruik het adres van de Interface voor doel-netwerk (`0.0.0.0`) die is (`10.0.1.10`) in dit voorbeeld.

```bat
route add 169.254.169.254/32 10.0.1.10 metric 1 -p
```

### <a name="custom-data"></a>Aangepaste gegevens
Instance Metadata Service biedt de mogelijkheid voor de virtuele machine toegang heeft tot de aangepaste gegevens. De binaire gegevens moet minder zijn dan 64 KB en wordt geleverd met de virtuele machine in base64-gecodeerde vorm.

Azure aangepaste gegevens kunnen worden ingevoegd met de virtuele machine via de REST-API's, PowerShell-Cmdlets, Azure Command Line Interface (CLI) of een ARM-sjabloon.

Zie voor een voorbeeld van Azure Command Line Interface [Custom Data en Cloud-Init op Microsoft Azure](https://azure.microsoft.com/blog/custom-data-and-cloud-init-on-windows-azure/).

Zie voor een voorbeeld van de sjabloon ARM [implementeren van een virtuele Machine met CustomData](https://github.com/Azure/azure-quickstart-templates/tree/master/101-vm-customdata).

Aangepaste gegevens is beschikbaar voor alle processen die worden uitgevoerd in de virtuele machine. Het wordt aangeraden dat klanten geen geheime gegevens in aangepaste gegevens invoegen.

Aangepaste gegevens kan op dit moment gegarandeerd beschikbaar zijn tijdens bootstrap van een virtuele machine. Als updates zijn aangebracht aan de virtuele machine zoals het toevoegen van schijven of grootte van de virtuele machine wijzigt, Instance Metadata Service geen aangepaste gegevens geeft. Aangepaste gegevens persistent via Instance Metadata Service die momenteel wordt uitgevoerd.

#### <a name="retrieving-custom-data-in-virtual-machine"></a>Bij het ophalen van aangepaste gegevens in de virtuele Machine
Instance Metadata Service kunt u aangepaste gegevens aan de virtuele machine in base64-gecodeerde vorm. Het volgende voorbeeld decodeert de met base64 gecodeerde tekenreeks.

> [!NOTE]
> De aangepaste gegevens in dit voorbeeld wordt geïnterpreteerd als een ASCII-tekenreeks die "Mijn aangepaste gegevens.", leest.

**Aanvraag**

```bash
curl -H "Metadata:true" "http://169.254.169.254/metadata/instance/compute/customData?api-version=2019-02-01&&format=text" | base64 --decode
```

**Antwoord**

```text
My custom data.
```

### <a name="examples-of-calling-metadata-service-using-different-languages-inside-the-vm"></a>Voorbeelden van het aanroepen van metadata-service met behulp van verschillende talen in de virtuele machine

Taal | Voorbeeld
---------|----------------
Ruby     | https://github.com/Microsoft/azureimds/blob/master/IMDSSample.rb
Start  | https://github.com/Microsoft/azureimds/blob/master/imdssample.go
Python   | https://github.com/Microsoft/azureimds/blob/master/IMDSSample.py
C++      | https://github.com/Microsoft/azureimds/blob/master/IMDSSample-windows.cpp
C#       | https://github.com/Microsoft/azureimds/blob/master/IMDSSample.cs
JavaScript | https://github.com/Microsoft/azureimds/blob/master/IMDSSample.js
PowerShell | https://github.com/Microsoft/azureimds/blob/master/IMDSSample.ps1
Bash       | https://github.com/Microsoft/azureimds/blob/master/IMDSSample.sh
Perl       | https://github.com/Microsoft/azureimds/blob/master/IMDSSample.pl
Java       | https://github.com/Microsoft/azureimds/blob/master/imdssample.java
Visual Basic | https://github.com/Microsoft/azureimds/blob/master/IMDSSample.vb
Puppet | https://github.com/keirans/azuremetadata

## <a name="faq"></a>Veelgestelde vragen

1. Ik krijg de fout `400 Bad Request, Required metadata header not specified`. Wat betekent dit?
   * De Instance Metadata Service is vereist voor de header `Metadata: true` moeten worden doorgegeven in de aanvraag. Deze header doorgeven in de REST-aanroep biedt toegang tot de Instance Metadata Service.
2. Waarom krijg ik geen compute-informatie voor mijn VM?
   * De Instance Metadata Service ondersteunt momenteel alleen exemplaren met Azure Resource Manager gemaakt. In de toekomst ondersteuning voor virtuele machines van Cloud Service kan worden toegevoegd.
3. Ik heb mijn virtuele Machine via Azure Resource Manager een tijd weer gemaakt. Waarom kan ik niet Zie compute-metagegevens?
   * Voor virtuele machines die na Sep 2016 zijn gemaakt, voegt u toe een [Tag](../../azure-resource-manager/resource-group-using-tags.md) om te zien starten compute-metagegevens. Voor oudere VM's (gemaakt voordat Sep 2016), toevoegen/verwijderen-extensies of gegevens schijven aan de virtuele machine metagegevens vernieuwen.
4. Ik zie niet alle gegevens voor de nieuwe versie is ingevuld
   * Voor virtuele machines die na Sep 2016 zijn gemaakt, voegt u toe een [Tag](../../azure-resource-manager/resource-group-using-tags.md) om te zien starten compute-metagegevens. Voor oudere VM's (gemaakt voordat Sep 2016), toevoegen/verwijderen-extensies of gegevens schijven aan de virtuele machine metagegevens vernieuwen.
5. Waarom krijg ik de fout `500 Internal Server Error`?
   * Probeer uw aanvraag op basis van exponentieel uitstel system. Neem contact op met ondersteuning van Azure als het probleem zich blijft voordoen.
6. Waar kan ik delen als u meer vragen/opmerkingen?
   * Stuur uw opmerkingen op https://feedback.azure.com.
7. Werkt dit voor instellen-instantie van virtuele-Machineschaalset?
   * Ja is Metadata-service beschikbaar voor Schalingsinstanties instellen.
8. Hoe krijg ik ondersteuning voor de service?
   * Voor ondersteuning voor de service, moet u een Ondersteuningsprobleem maken in Azure-portal voor de virtuele machine waar u zijn niet in staat om op te halen van de reactie met metagegevens na lange pogingen.
9. Kan ik er is een time-out opgetreden voor de aanroep naar de service krijgen?
   * Metagegevens-aanroepen moeten worden gemaakt van het primaire IP-adres toegewezen aan de netwerkkaart van de virtuele machine, ook als u hebt gewijzigd uw routes er moeten een route voor 169.254.0.0/16 adres buiten uw netwerkkaart.
10. Kan ik mijn labels in virtuele-machineschaalset bijgewerkt, maar ze niet weergegeven in de exemplaren in tegenstelling tot virtuele machines?
    * Op dit moment voor ScaleSets weergegeven labels alleen op de virtuele machine op een opnieuw opstarten/terugzetten van een installatiekopie/of een schijf met het exemplaar wijzigen.

    ![Ondersteuning voor Instance-Metagegevens](./media/instance-metadata-service/InstanceMetadata-support.png)

## <a name="next-steps"></a>Volgende stappen

- Meer informatie over [geplande gebeurtenissen](scheduled-events.md)
